🔸初めに
LaravelプロジェクトをDockerで構築します(composerも含む)。
Dockerを使って環境構築を行うことで、環境依存をなくし、開発環境の構築を簡単に行うことができます。
①docker環境構築
②Laravelプロジェクト動作確認
③dockerコマンド一覧
④Databaseバックアップ方法
⑤初期テーブル、初期データの設定方法
⑥Adminerのログイン情報
※よく使うコマンドに⭐️をつけています。

#######################################

🔸docker環境構築手順
①dockerとdocker-composeをインストール:
下記URLの手順に沿ってWindowsまたはMacにDocker Desktopをインストール
https://qiita.com/R_R/items/a09fab09ce9fa9e905c5

もしくはvagrantを使ってLinux環境にDockerをインストール(vagrantのインストール方法は省略)
sudo yum install docker -y
sudo curl -L "https://github.com/docker/compose/releases/download/v2.2.3/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
※上手くいかない場合は下記権限を付与して再度実行
sudo chmod +x /usr/local/bin/docker-compose

-動作確認(versionが表示されればOK)
docker -v 
docker-compose -v

②docker-composeでコンテナを起動:
VsCodeでresume-web-devを開く
pwd  # /resume-web-dev ディレクトリにいることを確認
cd infra/docker
docker-compose up -d
※初回は5~10分かかる(電波の良い環境で実行)

-動作確認
http://localhost:80 
#php-fpm socketが起動遅れて502エラーが出ることがあるので、その場合時間をおいて再度アクセスしてください

下記のコマンドを実行しコンテナが起動していることを確認(コンテナ名が表示されていればOK)
docker-compose ps 

コンテナ名:
nginx-container #Webサーバ
laravel-container #Laravelアプリケーション
mysql-container #データベース
jenkins-container #CI/CDツール
adminer-container #データベース管理ツール

#######################################

🔸dockerコマンド
⭐️コンテナ内部を確認する:
docker exec -it コンテナ名 bash

🔸docker各種コマンド:
⭐️起動
docker-compose up -d
再起動
docker-compose down
ログ確認
docker コンテナ名 logs -f

dockerステータス確認:
docker info
docker ps
docker images
docker volume ls
docker-compose ps

⭐️docker 削除系:
とりあえずコンテナ、イメージ、キャッシュを全削除したいとき(Volumeは削除されない)
docker stop $(docker ps -aq) 
docker rm $(docker ps -aq) 
docker rmi $(docker images -q)
docker system prune -a

🔸docker volume削除:
docker volume rm ボリューム名  
docker volume prune 
※データベースのテーブル、データが全て消えるので要注意

#######################################


⭐️データベースのバックアップ:
#コンテナ内部に入る
sudo docker exec -it mysql-container bash
#バックアップ(ファイル名は任意)
mysqldump resume_db -u root -p > test_dump_20240418.sql
#dumpファイルが作成されたことを確認
ls -la
#コンテナから出る
exit
#コンテナ外部にコピー(パスはbkフォルダまでの絶対パス)
sudo docker cp mysql-container:/test_dump_20240418.sql /Users/username/Desktop/resume-web-dev/infra/docker/db/bk/

#######################################

⭐️初期テーブル、初期データの設定方法:
①infra/docker/db/initディレクトリにdumpファイルを1つ配置する
②ファイルの先頭に下記コマンドを貼り付ける
CREATE DATABASE resume_db;
USE resume_db;
③docker-compose up -d

#######################################

⭐️Adminer: 
データベース管理ツール データベースの作成、削除、テーブルの作成、データの挿入、更新、削除などが行えます。
http://localhost:9090

ログイン情報:
データベース種類: MySQL	
サーバ: mysql
ユーザ名: root	
パスワード: ENVで設定したROOT_PASSWORD
データベース : ENVで設定したMYSQL_DATABASE
